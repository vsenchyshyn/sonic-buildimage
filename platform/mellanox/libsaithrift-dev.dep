# DPKG FRK

SPATH := $($(LIBSAITHRIFT_DEV)_SRC_PATH)
SLINKS := $(shell find $(SPATH) -type l -exec echo {} \; | grep -Ev ' ')
SMDEP_PATHS := $(SPATH) $(addprefix $(SPATH)/,$(shell cd $(SPATH) && git submodule status --recursive | awk '{print $$2}' | grep -Ev ' '))
SMDEP_FILES := $(foreach path,$(SMDEP_PATHS),$(filter-out $(SMDEP_PATHS),$(addprefix $(path)/,$(shell cd $(path) && git ls-files | grep -Ev ' '))))
DEP_FILES := $(SONIC_COMMON_FILES_LIST) $(PLATFORM_PATH)/libsaithrift-dev.mk $(PLATFORM_PATH)/libsaithrift-dev.dep
DEP_FILES += $(SONIC_COMMON_BASE_FILES_LIST)

$(LIBSAITHRIFT_DEV)_CACHE_MODE := GIT_CONTENT_SHA
$(LIBSAITHRIFT_DEV)_DEP_FLAGS := $(SONIC_COMMON_FLAGS_LIST)
$(LIBSAITHRIFT_DEV)_DEP_FILES := $(DEP_FILES)
$(LIBSAITHRIFT_DEV)_SMDEP_FILES := $(filter-out $(SLINKS),$(SMDEP_FILES))
$(LIBSAITHRIFT_DEV)_SMDEP_PATHS := $(SMDEP_PATHS)

$(PYTHON_SAITHRIFT)_CACHE_MODE := GIT_CONTENT_SHA
$(PYTHON_SAITHRIFT)_DEP_FLAGS := $(SONIC_COMMON_FLAGS_LIST)
$(PYTHON_SAITHRIFT)_DEP_FILES := $(DEP_FILES)
$(PYTHON_SAITHRIFT)_SMDEP_FILES := $(filter-out $(SLINKS),$(SMDEP_FILES))
$(PYTHON_SAITHRIFT)_SMDEP_PATHS := $(SMDEP_PATHS)

$(SAISERVER)_CACHE_MODE := GIT_CONTENT_SHA
$(SAISERVER)_DEP_FLAGS := $(SONIC_COMMON_FLAGS_LIST)
$(SAISERVER)_DEP_FILES := $(DEP_FILES)
$(SAISERVER)_SMDEP_FILES := $(filter-out $(SLINKS),$(SMDEP_FILES))
$(SAISERVER)_SMDEP_PATHS := $(SMDEP_PATHS)

$(SAISERVER_DBG)_CACHE_MODE := GIT_CONTENT_SHA
$(SAISERVER_DBG)_DEP_FLAGS := $(SONIC_COMMON_FLAGS_LIST)
$(SAISERVER_DBG)_DEP_FILES := $(DEP_FILES)
$(SAISERVER_DBG)_SMDEP_FILES := $(filter-out $(SLINKS),$(SMDEP_FILES))
$(SAISERVER_DBG)_SMDEP_PATHS := $(SMDEP_PATHS)
